<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ–°å¹´ä¸“å±ç¥ç¦</title>

  <style>
    :root{
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --stroke: rgba(255,255,255,.16);
      --glow: 0 0 30px rgba(124,92,255,.35), 0 0 80px rgba(0,255,240,.12);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui,-apple-system,"PingFang SC","Microsoft YaHei",Arial;
      color:var(--txt);
      background:
        radial-gradient(1200px 800px at 20% 10%, #1A2A6C 0%, transparent 60%),
        radial-gradient(900px 700px at 90% 20%, #0B8793 0%, transparent 55%),
        radial-gradient(800px 700px at 60% 90%, #7C5CFF 0%, transparent 60%),
        linear-gradient(180deg, #070A1A, #0A1B3A);
      overflow:hidden;
    }

    canvas#fx{ position:fixed; inset:0; width:100%; height:100%; z-index:0; }

    /* æ˜Ÿå°˜ */
    .grain{
      position:fixed; inset:0; pointer-events:none; z-index:0;
      opacity:.1; mix-blend-mode:overlay;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)'/%3E%3C/svg%3E");
      animation: grainMove 6s steps(8) infinite;
    }
    @keyframes grainMove{
      0%{ transform: translate3d(0,0,0); }
      25%{ transform: translate3d(-2%,1%,0); }
      50%{ transform: translate3d(2%,-1%,0); }
      75%{ transform: translate3d(-1%,-2%,0); }
      100%{ transform: translate3d(0,0,0); }
    }

    /* æ˜Ÿç©ºé—ªçƒå±‚ */
    .stars{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:0;
      opacity:.55;
      background:
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.8), rgba(255,255,255,0) 55%),
        radial-gradient(1px 1px at 22% 70%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%),
        radial-gradient(1px 1px at 45% 30%, rgba(255,255,255,.75), rgba(255,255,255,0) 55%),
        radial-gradient(1px 1px at 60% 80%, rgba(255,255,255,.6), rgba(255,255,255,0) 55%),
        radial-gradient(1px 1px at 78% 35%, rgba(255,255,255,.7), rgba(255,255,255,0) 55%),
        radial-gradient(1px 1px at 88% 60%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%),
        radial-gradient(1px 1px at 35% 55%, rgba(255,255,255,.65), rgba(255,255,255,0) 55%),
        radial-gradient(1px 1px at 52% 15%, rgba(255,255,255,.5), rgba(255,255,255,0) 60%);
      animation: twinkle 3.2s ease-in-out infinite alternate;
      mix-blend-mode: screen;
    }
    @keyframes twinkle{
      from{ opacity:.42; filter: blur(.2px); }
      to{ opacity:.68; filter: blur(0px); }
    }

    /* æµæ˜Ÿå±‚ */
    .meteors{ position:fixed; inset:0; pointer-events:none; z-index:0; }
    .meteor{
      position:absolute;
      top: var(--top);
      left: var(--left);
      width: 220px;
      height: 2px;
      background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.9), rgba(124,92,255,.25), rgba(255,255,255,0));
      transform: rotate(-18deg);
      opacity:0;
      filter: blur(.2px);
      animation: meteorFly var(--dur) linear infinite;
    }
    @keyframes meteorFly{
      0%{ transform: translate3d(0,0,0) rotate(-18deg); opacity:0; }
      5%{ opacity:.85; }
      20%{ opacity:0; }
      100%{ transform: translate3d(70vw, 45vh, 0) rotate(-18deg); opacity:0; }
    }

    /* æ¼‚æµ®å…‰ç‚¹ */
    .bokeh{ position:fixed; inset:-20vh -10vw; z-index:0; pointer-events:none; }
    .bokeh i{
      position:absolute;
      width:var(--s); height:var(--s); border-radius:999px;
      background:radial-gradient(circle, rgba(255,255,255,.9), rgba(255,255,255,0) 60%);
      opacity:var(--o);
      transform:translate(var(--x),var(--y));
      animation: float var(--t) linear infinite;
      mix-blend-mode: screen;
    }
    @keyframes float{
      from{ transform:translate(var(--x), calc(var(--y) + 30vh)); }
      to{ transform:translate(calc(var(--x) + 6vw), calc(var(--y) - 40vh)); }
    }

    .wrap{
      position:relative; z-index:1;
      min-height:100vh;
      display:grid; place-items:center;
      padding:24px;
    }

    .gate{
      width:min(560px,92vw);
      padding:22px;
      border-radius:22px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.08);
      backdrop-filter:blur(14px);
      box-shadow:var(--glow);
      text-align:center;
      transition:.45s;
    }
    .gate.hidden{
      opacity:0; transform:scale(.96) translateY(10px);
      pointer-events:none;
    }

    .logo{
      display:flex; justify-content:center; gap:10px;
      font-weight:900; margin-bottom:10px;
    }
    .dot{
      width:12px;height:12px;border-radius:50%;
      background:radial-gradient(circle,#fff,#7C5CFF 40%,#0B8793);
      box-shadow:0 0 16px rgba(124,92,255,.8);
    }
    .desc{ font-size:13px; color:var(--muted); margin-bottom:14px; }

    .row{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
    input{
      min-width:220px;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.2);
      background:rgba(0,0,0,.25);
      color:#fff;
      outline:none;
    }
    button{
      padding:12px 16px;
      border-radius:14px;
      border:1px solid rgba(124,92,255,.45);
      background:linear-gradient(90deg,rgba(124,92,255,.35),rgba(0,255,240,.18));
      color:#fff; font-weight:800; cursor:pointer;
      box-shadow: 0 0 18px rgba(124,92,255,.22);
    }

    .stage{
      position:absolute; inset:0;
      display:grid; place-items:center;
      opacity:0; transform:translateY(10px);
      transition:.6s;
      pointer-events:none;
    }
    .stage.show{ opacity:1; transform:none; pointer-events:auto; }

    /* =========================================================
       âœ… ç¥ç¦å¡ç‰‡ï¼šå…¥åœºæ›´é«˜çº§ + è¾¹ç¼˜å¾®å…‰ + æ›´é¡ºæ»‘æ‰«å…‰
       ========================================================= */
    .blessing{
      width:min(960px,94vw);
      padding:30px;
      border-radius:26px;
      background:rgba(255,255,255,.08);
      backdrop-filter:blur(14px);
      text-align:center;
      position:relative;
      overflow:hidden;

      /* è¾¹ç¼˜å¾®å…‰ï¼šç”¨å¤šå±‚é˜´å½±åšâ€œå¤–å‘å…‰ + å†…å‘å…‰â€ */
      border:1px solid rgba(255,255,255,.14);
      box-shadow:
        0 0 0 1px rgba(255,255,255,.06) inset,
        0 0 26px rgba(124,92,255,.22),
        0 0 78px rgba(0,255,240,.10);
      transform: translateY(10px) scale(.985);
      opacity: 0;
      filter: blur(6px);
      transition: transform .65s ease, opacity .65s ease, filter .65s ease;
    }

    /* å…¥åœºåï¼šæ¸…æ™°ã€å½’ä½ã€å¾®å‘¼å¸ */
    .stage.show .blessing{
      transform: translateY(0) scale(1);
      opacity: 1;
      filter: blur(0);
      animation: cardBreathe 3.2s ease-in-out infinite;
    }
    @keyframes cardBreathe{
      0%,100%{
        box-shadow:
          0 0 0 1px rgba(255,255,255,.06) inset,
          0 0 26px rgba(124,92,255,.22),
          0 0 78px rgba(0,255,240,.10);
      }
      50%{
        box-shadow:
          0 0 0 1px rgba(255,255,255,.07) inset,
          0 0 36px rgba(124,92,255,.30),
          0 0 110px rgba(0,255,240,.14);
      }
    }

    /* æ›´é¡ºæ»‘â€œæ‰«å…‰â€ï¼šæ”¹æˆæ¨ªå‘å…‰å¸¦æ»‘è¿‡ + æ›´æŸ”å’Œ */
    .blessing::after{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(110deg,
        rgba(255,255,255,0) 35%,
        rgba(255,255,255,.18) 46%,
        rgba(166,227,255,.12) 50%,
        rgba(255,255,255,.18) 54%,
        rgba(255,255,255,0) 65%);
      transform: translateX(-60%) rotate(12deg);
      opacity:.22;
      animation: sweep2 4.6s ease-in-out infinite;
      mix-blend-mode: overlay;
      pointer-events:none;
    }
    @keyframes sweep2{
      0%   { transform: translateX(-65%) rotate(12deg); opacity:.05; }
      25%  { opacity:.22; }
      50%  { opacity:.18; }
      100% { transform: translateX(65%) rotate(12deg); opacity:.05; }
    }

    /* è¾¹ç¼˜å¾®å…‰â€œå…‰åœˆâ€ */
    .blessing::before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius:28px;
      padding:2px;
      background: linear-gradient(135deg,
        rgba(124,92,255,.55),
        rgba(0,255,240,.35),
        rgba(255,255,255,.15),
        rgba(124,92,255,.45));
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity:.35;
      filter: blur(.2px);
      pointer-events:none;
    }

    .blessing > *{ position:relative; z-index:1; }

    /* æ ‡é¢˜ */
    .h1{
      display:flex; justify-content:center; gap:12px; flex-wrap:wrap;
      font-size:clamp(30px,4vw,54px); font-weight:950;
    }
    .emoji{ text-shadow:0 0 18px rgba(255,255,255,.3); }
    .titleText{
      background:linear-gradient(90deg,#fff,#A6E3FF,#C9B7FF,#fff);
      -webkit-background-clip:text; color:transparent;
    }

    /* âœ… æ‰“å­—æœºï¼šæ–‡æœ¬å®¹å™¨ */
    .p{
      margin-top:18px;
      line-height:1.9;
      white-space:pre-wrap;
      min-height: 3.8em; /* é˜²æŠ–ï¼šé¿å…æ‰“å­—æ—¶é«˜åº¦è·³åŠ¨ */
    }
    /* å…‰æ ‡ */
    .caret{
      display:inline-block;
      width:.6ch;
      transform: translateY(1px);
      opacity:.9;
      animation: blink 1s step-end infinite;
    }
    @keyframes blink{
      50%{ opacity:0; }
    }

    body.party{ filter:saturate(1.12) contrast(1.06); }

    /* è½»æç¤º */
    .hint{
      position:fixed;
      left:50%; bottom:22px;
      transform:translateX(-50%) translateY(10px);
      padding:10px 16px;
      border-radius:999px;
      font-size:12px;
      color:rgba(255,255,255,.85);
      background:rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.18);
      backdrop-filter:blur(10px);
      opacity:0;
      transition:.4s;
      z-index:5;
      pointer-events:none;
    }
    .hint.show{
      opacity:1;
      transform:translateX(-50%) translateY(0);
    }

    @media (max-width: 520px){
      .grain{ opacity:.08; }
    }

    /* =========================================================
       å¾®ä¿¡å†…ç½®æµè§ˆå™¨å¼•å¯¼å±‚ï¼ˆåªåœ¨å¾®ä¿¡æ˜¾ç¤ºï¼‰
       ========================================================= */
    .wxGuide{
      position:fixed;
      inset:0;
      z-index:999;
      display:none;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
    }
    .wxGuide.show{ display:block; }

    .wxCard{
      position:absolute;
      left:50%;
      top:16vh;
      transform:translateX(-50%);
      width:min(620px, 92vw);
      border-radius:22px;
      border:1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: 0 0 30px rgba(124,92,255,.22), 0 0 80px rgba(0,255,240,.10);
      padding:18px 18px 16px;
    }
    .wxTitle{
      font-weight:900;
      letter-spacing:.6px;
      font-size:18px;
      margin-bottom:8px;
      background: linear-gradient(90deg, #fff, #A6E3FF 35%, #C9B7FF 70%, #fff);
      -webkit-background-clip:text;
      color:transparent;
    }
    .wxText{
      font-size:13px;
      line-height:1.75;
      color: rgba(255,255,255,.86);
    }
    .wxSteps{
      margin-top:12px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .wxStep{
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.82);
    }
    .wxTip{
      margin-top:10px;
      font-size:12px;
      color: rgba(255,255,255,.75);
    }
    .wxArrow{
      position:absolute;
      top:10px;
      right:16px;
      width:170px;
      height:120px;
      pointer-events:none;
      background:
        radial-gradient(closest-side at 78% 20%, rgba(255,255,255,.85), rgba(255,255,255,0) 65%),
        linear-gradient(135deg, rgba(255,255,255,.75), rgba(255,255,255,0));
      clip-path: polygon(100% 0, 65% 4%, 78% 18%, 35% 55%, 40% 62%, 76% 28%, 90% 44%);
      opacity:.75;
      filter: drop-shadow(0 0 18px rgba(124,92,255,.35));
    }

    /* å‡å°‘åŠ¨ç”»åå¥½ */
    @media (prefers-reduced-motion: reduce){
      .bokeh i, .meteor, .stars, .grain, .blessing::after{ animation:none !important; }
      .stage, .gate, .blessing{ transition:none !important; }
      .caret{ animation:none !important; }
    }
  </style>
</head>

<body>
  <canvas id="fx"></canvas>
  <div class="grain"></div>
  <div class="stars"></div>

  <div class="meteors" aria-hidden="true">
    <div class="meteor" style="--top:12vh;--left:-20vw;--dur:7.6s"></div>
    <div class="meteor" style="--top:28vh;--left:-35vw;--dur:9.4s"></div>
    <div class="meteor" style="--top:8vh; --left:-55vw;--dur:11.2s"></div>
  </div>

  <div class="bokeh" aria-hidden="true">
    <i style="--s:14px;--o:.25;--x:8vw; --y:78vh;--t:14s"></i>
    <i style="--s:22px;--o:.18;--x:16vw;--y:70vh;--t:18s"></i>
    <i style="--s:18px;--o:.22;--x:26vw;--y:84vh;--t:16s"></i>
    <i style="--s:28px;--o:.14;--x:38vw;--y:72vh;--t:22s"></i>
    <i style="--s:16px;--o:.22;--x:48vw;--y:86vh;--t:15s"></i>
    <i style="--s:24px;--o:.16;--x:60vw;--y:74vh;--t:21s"></i>
    <i style="--s:12px;--o:.24;--x:72vw;--y:82vh;--t:13s"></i>
    <i style="--s:30px;--o:.12;--x:84vw;--y:68vh;--t:25s"></i>
    <i style="--s:18px;--o:.20;--x:92vw;--y:88vh;--t:17s"></i>

    <i style="--s:12px;--o:.20;--x:12vw;--y:52vh;--t:19s"></i>
    <i style="--s:26px;--o:.14;--x:30vw;--y:48vh;--t:24s"></i>
    <i style="--s:14px;--o:.22;--x:52vw;--y:54vh;--t:18s"></i>
    <i style="--s:22px;--o:.14;--x:70vw;--y:50vh;--t:23s"></i>
    <i style="--s:16px;--o:.18;--x:88vw;--y:46vh;--t:20s"></i>
  </div>

  <div class="wrap">
    <div class="gate" id="gate">
      <div class="logo"><span class="dot"></span>æ–°å¹´ä¸“å±ç¥ç¦</div>
      <p class="desc">è¾“å…¥ä½ çš„å§“åï¼Œç‚¹äº®ä¸“å±äºä½ çš„è·¨å¹´çƒŸèŠ± âœ¨</p>
      <div class="row">
        <input id="name" placeholder="è¯·è¾“å…¥å§“å / æ˜µç§°" />
        <button id="go">ç”Ÿæˆ</button>
      </div>
    </div>

    <div class="stage" id="stage">
      <div class="blessing">
        <h1 class="h1" id="headline"></h1>
        <div class="p" id="text"></div>
      </div>
    </div>
  </div>

  <div class="hint" id="hint">è½»è§¦ä»»æ„ä½ç½®ï¼Œç‚¹äº®éŸ³ä¹ä¸çƒŸèŠ± âœ¨</div>

  <!-- å¾®ä¿¡å¼•å¯¼å±‚ï¼ˆé»˜è®¤éšè—ï¼Œä»…å¾®ä¿¡æ˜¾ç¤ºï¼‰ -->
  <div class="wxGuide" id="wxGuide" aria-hidden="true">
    <div class="wxCard">
      <div class="wxTitle">å»ºè®®åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</div>
      <div class="wxText">
        å¾®ä¿¡å†…ç½®ç¯å¢ƒä¼šé™åˆ¶éŸ³ä¹ä¸éƒ¨åˆ†åŠ¨ç”»æ•ˆæœã€‚<br/>
        è¯·ç‚¹å‡»å³ä¸Šè§’ <b>ã€ŒÂ·Â·Â·ã€</b> â†’ é€‰æ‹© <b>ã€Œåœ¨æµè§ˆå™¨æ‰“å¼€ã€</b>ï¼Œä½“éªŒæ›´å®Œæ•´ âœ¨
      </div>
      <div class="wxSteps">
        <span class="wxStep">1 ç‚¹å³ä¸Šè§’ã€ŒÂ·Â·Â·ã€</span>
        <span class="wxStep">2 é€‰æ‹©ã€Œåœ¨æµè§ˆå™¨æ‰“å¼€ã€</span>
        <span class="wxStep">3 è½»è§¦å±å¹•å¼€å¯éŸ³ä¹</span>
      </div>
      <div class="wxTip">æ‰“å¼€åï¼šè¾“å…¥å§“å â†’ ç”Ÿæˆä¸“å±ç¥ç¦ ğŸ†</div>
    </div>
    <div class="wxArrow" aria-hidden="true"></div>
  </div>

<script>
/* ===== å·¥å…· ===== */
const $ = s => document.querySelector(s);
const rand = a => a[Math.floor(Math.random()*a.length)];

/* ===== å¾®ä¿¡å†…ç½®æµè§ˆå™¨å¼•å¯¼ ===== */
(function wechatGuide(){
  const ua = navigator.userAgent.toLowerCase();
  const isWeChat = ua.includes("micromessenger");
  const guide = document.getElementById("wxGuide");
  if(isWeChat && guide) guide.classList.add("show");
})();

/* ===== ğŸµ èƒŒæ™¯éŸ³ä¹ + è½»æç¤º ===== */
const MUSIC_URL = "./Shakira - Try Everything.mp3"; // â† mp3 è·¯å¾„
const audio = new Audio(MUSIC_URL);
audio.loop = true;
audio.volume = 0.35;

const hint = $("#hint");
let musicStarted = false;

function showHint(){ hint.classList.add("show"); }
function hideHint(){ hint.classList.remove("show"); }

async function tryPlayMusic(){
  if(musicStarted) return;
  try{
    await audio.play();
    musicStarted = true;
    hideHint();
  }catch{
    showHint();
  }
}
window.addEventListener("load", tryPlayMusic);

function unlockOnce(){
  tryPlayMusic();
  window.removeEventListener("pointerdown", unlockOnce);
  window.removeEventListener("touchstart", unlockOnce);
  window.removeEventListener("keydown", unlockOnce);
}
window.addEventListener("pointerdown", unlockOnce, {passive:true});
window.addEventListener("touchstart", unlockOnce, {passive:true});
window.addEventListener("keydown", unlockOnce);

/* ===== æ–‡æ¡ˆ ===== */
const pool=[
 "æ„¿æ–°çš„ä¸€å¹´ï¼Œä½ æŠŠçƒ­çˆ±ç•™ç»™ç”Ÿæ´»ï¼ŒæŠŠæ¸©æŸ”ç•™ç»™è‡ªå·±ã€‚",
 "æ„¿ä½ çœ¼é‡Œæœ‰å…‰ï¼Œå¿ƒä¸­æœ‰æ¢¦ï¼Œæ­¥å±¥åšå®šã€‚",
 "æ„¿æ‰€æœ‰åŠªåŠ›éƒ½æœ‰å›å“ï¼Œæ‰€æœ‰ç­‰å¾…ä¸è¢«è¾œè´Ÿã€‚",
 "æ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾…ï¼Œä¹Ÿå­¦ä¼šæ¸©æŸ”å¯¹å¾…è‡ªå·±ã€‚",
 "æ„¿ä½ æ–°çš„ä¸€å¹´ï¼Œå¹³å®‰å–œä¹ï¼Œè‡ªç”±é—ªè€€ã€‚"
];

let party = false;

/* ===== âœ… æ‰“å­—æœºï¼ˆ2ç§’å®Œæˆï¼‰ ===== */
function typewriter(el, text, durationMs = 2000){
  // å…ˆæ¸…ç©º
  el.innerHTML = "";
  const caret = document.createElement("span");
  caret.className = "caret";
  caret.textContent = "â–";
  el.appendChild(caret);

  const chars = Array.from(text); // æ”¯æŒä¸­æ–‡/emoji
  const total = chars.length;
  const step = Math.max(12, Math.floor(durationMs / Math.max(1, total)));

  let i = 0;
  const timer = setInterval(()=>{
    if(i >= total){
      clearInterval(timer);
      // åœç•™ä¸€ä¸‹å†ç§»é™¤å…‰æ ‡æ›´è‡ªç„¶
      setTimeout(()=>caret.remove(), 500);
      return;
    }
    caret.insertAdjacentText("beforebegin", chars[i]);
    i++;
  }, step);

  return () => clearInterval(timer);
}

let stopTyping = null;

function show(name){
  const clean = (name || "").trim().slice(0,18);
  if(!clean) return;

  const year = new Date().getFullYear() + 1;

  $("#headline").innerHTML =
    `<span class="emoji">ğŸ†</span><span class="titleText">${clean}ï¼Œ${year} æ–°å¹´å¿«ä¹ï¼</span>`;

  // âœ… æ‰“å­—æœºï¼šå…ˆåœæ­¢ä¸Šä¸€æ¬¡
  if(typeof stopTyping === "function") stopTyping();

  const fullText = rand(pool) + `\n\nâ€” ä¸“å±ç»™ ${clean} çš„ç¥ç¦`;
  stopTyping = typewriter($("#text"), fullText, 2000);

  $("#gate").classList.add("hidden");
  $("#stage").classList.add("show");
  document.body.classList.add("party");

  party = true;
  burst(7);
}

$("#go").onclick=()=>show($("#name").value);
$("#name").onkeydown=e=>e.key==="Enter" && show($("#name").value);

/* ===== çƒŸèŠ±ï¼ˆå‡çº§ç‰ˆï¼šç²’å­çƒŸèŠ±ï¼‰ ===== */
const canvas = $("#fx");
const ctx = canvas.getContext("2d");

let W=0,H=0;
let DPR=Math.max(1, Math.min(2, window.devicePixelRatio||1));

function resize(){
  W = canvas.clientWidth;
  H = canvas.clientHeight;
  canvas.width = Math.floor(W*DPR);
  canvas.height = Math.floor(H*DPR);
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener("resize", resize);
resize();

const rockets = [];
const parts = [];
const gravity = 0.06;
const friction = 0.985;

function pickColor(){
  return rand([
    [124,92,255],[0,255,240],[255,120,200],[255,220,120],[140,255,160]
  ]);
}

function Rocket(x){
  this.x = x;
  this.y = H + 8;
  this.vx = (Math.random() - 0.5) * 1.35;
  this.vy = -(7.0 + Math.random() * 2.2);
  this.t = 0;
  this.m = 42 + Math.random() * 42;
  this.c = pickColor();
}

function Part(x, y, c){
  const a = Math.random() * Math.PI * 2;
  const s = 2.0 + Math.random() * 4.8;
  this.x = x; this.y = y;
  this.vx = Math.cos(a) * s;
  this.vy = Math.sin(a) * s;
  this.a = 1;
  this.d = 0.012 + Math.random() * 0.02;
  this.r = 1.2 + Math.random() * 2.2;
  this.c = c;
}

function launch(){
  rockets.push(new Rocket(W * (0.2 + 0.6 * Math.random())));
}

function burst(n=3){
  for(let i=0;i<n;i++) setTimeout(launch, i*120);
}

// å¼€åœºè½»å¾®çƒŸèŠ±ï¼ˆä¸å½±å“è¾“å…¥ï¼‰
setTimeout(()=>burst(2), 520);

function tick(){
  requestAnimationFrame(tick);

  ctx.fillStyle = party ? "rgba(0,0,0,.13)" : "rgba(0,0,0,.20)";
  ctx.fillRect(0,0,W,H);

  for(let i=rockets.length-1;i>=0;i--){
    const r = rockets[i];
    r.t++;
    r.x += r.vx;
    r.y += r.vy;
    r.vy += gravity * 0.55;

    ctx.beginPath();
    ctx.moveTo(r.x, r.y);
    ctx.lineTo(r.x - r.vx * 7, r.y - r.vy * 7);
    ctx.strokeStyle = `rgba(${r.c[0]},${r.c[1]},${r.c[2]},${party?0.35:0.25})`;
    ctx.lineWidth = 2;
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(r.x, r.y, 2.2, 0, Math.PI*2);
    ctx.fillStyle = `rgba(${r.c[0]},${r.c[1]},${r.c[2]},0.95)`;
    ctx.fill();

    if(r.t > r.m || r.y < H*0.26){
      const cnt = 90 + Math.floor(Math.random()*50);
      for(let j=0;j<cnt;j++) parts.push(new Part(r.x, r.y, r.c));
      rockets.splice(i,1);
    }
  }

  for(let i=parts.length-1;i>=0;i--){
    const p = parts[i];
    p.vx *= friction;
    p.vy *= friction;
    p.vy += gravity;
    p.x += p.vx;
    p.y += p.vy;
    p.a -= p.d;

    if(p.a <= 0){
      parts.splice(i,1);
      continue;
    }

    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fillStyle = `rgba(${p.c[0]},${p.c[1]},${p.c[2]},${p.a})`;
    ctx.fill();
  }

  const prob = party ? 0.030 : 0.012;
  if(Math.random() < prob) launch();
}
requestAnimationFrame(tick);
</script>
</body>
</html>
